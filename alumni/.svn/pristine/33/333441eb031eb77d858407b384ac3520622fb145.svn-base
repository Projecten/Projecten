<?php

if (!defined('BASEPATH'))
    exit('No direct script access allowed');

class Alumnus extends CI_Controller {

// +----------------------------------------------------------
// | Beershop
// +----------------------------------------------------------
// | KHK - 2 TI - 201x-201x
// +----------------------------------------------------------
// | Default controller
// |
// +----------------------------------------------------------
// | K. Vangeel
// +----------------------------------------------------------

    public function __construct() {
        parent::__construct();
        //laden van libraries en helpers
        $this->load->library('pagination');
        $this->load->helper('notation');
        $this->load->helper('cookie');
//      $this->load->library('session');
//      
//      alle nodige gegevens éénmaal oproepen per pagina
        $data['title'] = 'Alumni bekijken - project Alumni';
        $data['recht'] = $this->session->userdata('recht');
        $data['username'] = $this->session->userdata('username');
        
        //beveiligen van url
        if (!$this->authex->loggedIn()) {
                redirect('home/login');
        } else {
            $user = $this->authex->getUserInfo();
        }
    }

    public function index() {
        $partials = array('header' => 'main_header', 'content' => 'home_index', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login');
        $this->template->load('main_master', $partials, $data);
    }

    public function fouteUser() {
        //doorverwijzen met deze gegevens
        $partials = array('header' => 'main_header', 'content' => 'auth/login_form', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login');
        $this->template->load('main_master', $partials, $data);
    }

    public function evenementenBekijkenZoeken($startRow = 0) {

        $aantal = $this->input->get("aantal");
        //recht ophalen
        $recht = $rechten;
        //indien er recht is opgehaald
        if (isset($recht)) {
            if ($recht != 0) {
                $data['title'] = 'Evenementen bekijken - project Alumni';

                $this->load->model('evenement_model');

                $info = $this->session->userdata('zoekinfoEvenementen');

                $data['info'] = $info;

                $data['evenementen'] = $this->evenement_model->getAllByNaamPlaatsDatum($info);

                //paging 
                if (($info['pagination']) == NULL) {
                    $aantal = 10;
                } else {
                    $aantal = $info['pagination'];
                }
                $config['base_url'] = site_url('alumnus/evenementenBekijkenZoeken');
                $config['total_rows'] = $this->evenement_model->getCountByNaamPlaatsDatum($info);
                $config['per_page'] = $aantal;
                $config['first_link'] = "&lt;&lt; Eerste";
                $config['last_link'] = "Laatste &gt;&gt;";
                $config['num_links'] = 10;
                $this->pagination->initialize($config);

                $data['evenementen'] = $this->evenement_model->getAllPaginationByNaamPlaatsDatum($info, $aantal, $startRow);
                $data['links'] = $this->pagination->create_links();

                $plaatsen[0] = "";
                foreach ($this->plaats_model->getAll() as $plaats) {
                    $plaatsen[$plaats->id] = $plaats->locatie;
                }
                $data['plaatsen'] = $plaatsen;

                $partials = array('header' => 'main_header', 'content' => 'user/evenementenzoeken', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login', 'nieuws' => 'main_nieuws');
                $this->template->load('main_master', $partials, $data);
            } else {
                //verwijzen naar function fouteUser();
                $this->fouteUser();
            }
        }
    }

//detail pagina van evenementen
    public function evenementdetail($id) {
        //recht ophalen
        $recht = $rechten;
        //indien er een recht is opgehaald
        if (isset($recht)) {
            $data['title'] = 'Details - project Alumni';

            $this->load->model('evenement_model');
            $this->load->model('uitgenodigd_model');
            $data['evenement'] = $this->evenement_model->getWithPlaats($id);
            $data['uitgenodigden'] = $this->uitgenodigd_model->getAllByEvenement($id);

            $partials = array('header' => 'main_header', 'content' => 'user/evenementendetails', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login', 'nieuws' => 'main_nieuws');
            $this->template->load('main_master', $partials, $data);
        } else {
            //verwijzen naar function fouteUser();
            $this->fouteUser();
        }
    }

//inschrijven voor een evenement
    public function inschrijven($id) {
        //recht ophalen
        $recht = $rechten;
        //indien er een recht is opgehaald
        if (isset($recht)) {
            $uitgenodigde->evenementId = $id;
//            $uitgenodigde->alumnusId = $this->tank_auth->get_alumnusId();
            $uitgenodigde->alumnusId = 1;

            $uitgenodigde->aanwezig = 1;
            $uitgenodigde->wasAanwezig = 0;
            $uitgenodigde->datumInschrijving = date('Y-m-d');

            //inschrijving_model laden
            $this->load->model("uitgenodigd_model");
            //evenement ophalen
            $this->load->model("evenement_model");
            $evenement = $this->evenement_model->get($id);


            $controle = $this->uitgenodigd_model->insert($uitgenodigde);
            if ($controle == 1) {
                //indien je nog niet bent ingeschreven voor evenement
                echo $data['message'] = "Je bent ingeschreven voor het '" . $evenement->naam . "' evenement.";
            } else {
                //indien je al wel bent ingeschreven voor evenement
                echo $data['message'] = "Je bent al ingeschreven voor het '" . $evenement->naam . "' evenement.";
            }
//
//        //aangepaste message tonen
            $data['title'] = 'Inschrijven - Alumni project';
            $data['vorigePagina'] = 'index.php/alumnus/evenementenBekijken';

            $partials = array('header' => 'main_header', 'content' => 'auth/general_message', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login', 'nieuws' => 'main_nieuws');
            $this->template->load('main_master', $partials, $data);
        } else {
            //verwijzen naar function fouteUser();
            $this->fouteUser();
        }
    }

    //functie werkt nog niet
//    public function uitschrijven($id) {
//        $data['actie'] = 'uitschrijven';
//        $data['message'] = 'U bent uitgeschreven!';
//        $data['vorigePagina'] = 'index.php/alumnus/evenementenBekijken';
//        $partials = array('header' => 'main_header', 'content' => 'user/evenementenzoeken_ajax', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login', 'nieuws' => 'main_nieuws');
//        $this->template->load('main_master', $partials, $data);
//    }
//    
//    
    //profiel bekijken
    //functie werkt nog niet!
    public function profielBekijken($id) {
            $data['title'] = 'Profiel - project Alumni';
            $data['id'] = $this->session->userdata('id');
            $data['recht'] = $this->session->userdata('recht');
            $data['username'] = $this->session->userdata('username');
            $data['email'] = $this->session->userdata('email');
            
            $this->load->model('alumnus_model');
            $data['gebruiker'] = $this->alumnus_model->getByLoginId($this->session->userdata('loginId'));
            
     
        $partials = array('header' => 'main_header', 'content' => 'alumnus/profiel', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login', 'nieuws' => 'main_nieuws');
        $this->template->load('main_master', $partials, $data);
    }

    /* public function updateProfiel() {
      //recht ophalen
      $recht = 3;
      //gegevens ophalen
      $alumnus->id = $this->input->post('id');
      $alumnus->naam = $this->input->post('naam');
      $alumnus->voornaam = $this->input->post('voornaam');
      $alumnus->secundairEmailadres = $this->input->post('secundairEmailadres');
      $alumnus->werkgever = $this->input->post('werkgever');
      $alumnus->jobomschrijving = $this->input->post('jobomschrijving');

      $this->load->model('alumnus_model');
      }
     */
}

/* End of file home.php */
    /* Location: ./application/controllers/home.php */


    