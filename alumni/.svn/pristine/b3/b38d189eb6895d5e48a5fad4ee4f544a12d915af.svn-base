<?php

if (!defined('BASEPATH'))
    exit('No direct script access allowed');

class Alumnus extends CI_Controller {

// +----------------------------------------------------------
// | Beershop
// +----------------------------------------------------------
// | KHK - 2 TI - 201x-201x
// +----------------------------------------------------------
// | Default controller
// |
// +----------------------------------------------------------
// | K. Vangeel
// +----------------------------------------------------------

    public function __construct() {
        parent::__construct();
        //laden van libraries en helpers
        $this->load->library('pagination');
        $this->load->helper('notation');
        $this->load->helper('cookie');
        $this->load->helper('notation_helper');
//      $this->load->library('session');
//      
//      alle nodige gegevens éénmaal oproepen per pagina
        $data['title'] = 'Alumni bekijken - project Alumni';
        $data['recht'] = $this->session->userdata('recht');
        $data['username'] = $this->session->userdata('username');

        //beveiligen van url
        if (!$this->authex->loggedIn()) {
            redirect('home/login');
        } else {
            $user = $this->authex->getUserInfo();
        }
    }

    public function index() {
        $partials = array('header' => 'main_header', 'content' => 'home_index', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login');
        $this->template->load('main_master', $partials, $data);
    }

    public function fouteUser() {
        //doorverwijzen met deze gegevens
        $partials = array('header' => 'main_header', 'content' => 'auth/login_form', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login');
        $this->template->load('main_master', $partials, $data);
    }

    public function evenementenBekijkenZoeken($startRow = 0) {

        $aantal = $this->input->get("aantal");
        //recht ophalen
        $recht = $this->session->userdata("recht");
        //indien er recht is opgehaald

        if ($recht != 0) {
            $data['title'] = 'Evenementen bekijken - project Alumni';

            $this->load->model('evenement_model');

            $info = $this->session->userdata('zoekinfoEvenementen');

            $data['info'] = $info;

            $data['evenementen'] = $this->evenement_model->getAllByNaamPlaatsDatum($info);

            //paging 
//            if (($info['pagination']) == NULL) {
//                $aantal = 10;
//            } else {
//                $aantal = $info['pagination'];
//            }
            $config['base_url'] = site_url('alumnus/evenementenBekijkenZoeken');
            $config['total_rows'] = $this->evenement_model->getCountByNaamPlaatsDatum($info);
            $config['per_page'] = $aantal;
            $config['first_link'] = "&lt;&lt; Eerste";
            $config['last_link'] = "Laatste &gt;&gt;";
            $config['num_links'] = 10;
            $this->pagination->initialize($config);

            //paging 
//            if (($info['pagination']) == NULL) {
//               $aantal = 10;
//            } else {
//                $aantal = $info['pagination'];
//            }
            $config['base_url'] = site_url('alumnus/evenementenBekijkenZoeken');
            $config['total_rows'] = $this->evenement_model->getCountByNaamPlaatsDatum($info);
            $config['per_page'] = $aantal;
            $config['first_link'] = "&lt;&lt; Eerste";
            $config['last_link'] = "Laatste &gt;&gt;";
            $config['num_links'] = 10;
            $this->pagination->initialize($config);

            $data['evenementen'] = $this->evenement_model->getAllPaginationByNaamPlaatsDatum($info, $aantal, $startRow);
            $data['links'] = $this->pagination->create_links();

            //alle plaatsen opladen
            $plaatsen[0] = "";
            foreach ($this->plaats_model->getAll() as $plaats) {
                $plaatsen[$plaats->id] = $plaats->locatie;
            }
            $data['plaatsen'] = $plaatsen;

            //controle op ingeschreven
            $this->load->model('uitgenodigd_model');
            $data['evenementen'] = $this->evenement_model->getAll();


            $partials = array('header' => 'main_header', 'content' => 'user/evenementenzoeken', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login', 'nieuws' => 'main_nieuws');
            $this->template->load('main_master', $partials, $data);
        } else {
            //verwijzen naar function fouteUser();
            $this->fouteUser();
        }
    }

//detail pagina van evenementen
    public function evenementdetail($id) {
        //recht ophalen
        $recht = $this->session->userdata("recht");
        //indien er een recht is opgehaald
        if (isset($recht)) {
            $data['title'] = 'Details - project Alumni';
            $data['recht'] = $this->session->userdata('recht');
            $data['username'] = $this->session->userdata('username');

            $this->load->model('evenement_model');
            $this->load->model('uitgenodigd_model');
            $data['evenement'] = $this->evenement_model->getWithPlaats($id);
            $data['uitgenodigden'] = $this->uitgenodigd_model->getAllByEvenement($id);

            $partials = array('header' => 'main_header', 'content' => 'user/evenementendetails', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login', 'nieuws' => 'main_nieuws');
            $this->template->load('main_master', $partials, $data);
        } else {
            //verwijzen naar function fouteUser();
            $this->fouteUser();
        }
        }

//inschrijven voor een evenement
        public function inschrijven($id) {
        $uitgenodigde->evenementId = $id;
        $uitgenodigde->aanwezig = 1;
        $uitgenodigde->wasAanwezig = 0;
        $uitgenodigde->datumInschrijving = date('Y-m-d');
        //alumnusId ophalen
        $this->load->model('alumnus_model');
        $alumnusId = $this->alumnus_model->getByLoginId($this->session->userdata('id'));
        $uitgenodigde->loginId = $alumnusId->loginId;

        //uitgenodigd_model laden
        $this->load->model("uitgenodigd_model");
        //evenement ophalen
        $this->load->model("evenement_model");
        $evenement = $this->evenement_model->get($id);

        $controle = $this->uitgenodigd_model->insert($uitgenodigde);
        if ($controle == 1) {
            //indien je nog niet bent ingeschreven voor evenement
            echo $data['message'] = "Je bent ingeschreven voor het '" . $evenement->naam . "' evenement.";
        } else {
            //indien je al wel bent ingeschreven voor evenement
            echo $data['message'] = "Je bent al ingeschreven voor het '" . $evenement->naam . "' evenement.";
        }
//        //aangepaste message tonen
        $data['title'] = 'Inschrijven - Alumni project';
        $data['vorigePagina'] = 'index.php/alumnus/evenementenBekijken';

        $partials = array('header' => 'main_header', 'content' => 'user/fout_message', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login', 'nieuws' => 'main_nieuws');
        $this->template->load('main_master', $partials, $data);
    }

    //functie werkt nog niet
//    public function uitschrijven($id) {
//        $data['actie'] = 'uitschrijven';
//        $data['message'] = 'U bent uitgeschreven!';
//        $data['vorigePagina'] = 'index.php/alumnus/evenementenBekijken';
//        $partials = array('header' => 'main_header', 'content' => 'user/evenementenzoeken_ajax', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login', 'nieuws' => 'main_nieuws');
//        $this->template->load('main_master', $partials, $data);
//    }
//    
//     
//Profiel bekijken + bewerken
    public function profiel() {
        $data['title'] = 'Profiel aanpassen - Alumnus';
        $data['recht'] = $this->session->userdata('recht');
        $data['username'] = $this->session->userdata('username');

        if (1 == $this->session->userdata('recht')) {
            $this->load->model('school_model');
            $this->load->model('richting_model');
            $this->load->model('login_model');
            $this->load->model('alumnus_model');

            // scholen in array zetten om door te geven aan de pagina
            foreach ($this->school_model->getAll() as $school) {
                $scholen[$school->id] = $school->naam;
            }
            $data['scholen'] = $scholen;

            // richtingen in array zetten om door te geven aan de pagina
            foreach ($this->richting_model->getAll() as $richting) {
                $richtingen[$richting->id] = $richting->naam;
            }
            $data['richtingen'] = $richtingen;

            //login ophalen
            $data['login'] = $this->login_model->getAlumnusByLogin($this->session->userdata('id'));

            //alumnus ophalen
            $data['alumnus'] = $this->alumnus_model->getByLoginId($this->session->userdata('id'));
        } else {
            //redirect naar de juist pagina om gegevens op te halen
            redirect('admin/profiel');
        }

        //doorsturen naar pagina
        $partials = array('header' => 'main_header', 'content' => 'alumnus/profiel', 'footer' => 'main_footer', 'menu' => 'main_menu', 'sidebar' => 'main_sidebar', 'login' => 'main_login', 'nieuws' => 'main_nieuws');
        $this->template->load('main_master', $partials, $data);
    }

    public function updateProfiel() {

        //gegevens ophalen
        $alumnus->id = $this->input->post('id');
        $alumnus->loginId = $this->input->post('loginId');
        $alumnus->richtingId = $this->input->post('richting');
        $alumnus->schoolId = $this->input->post('school');
        $alumnus->werkgever = $this->input->post('werkgever');
        $alumnus->jobomschrijving = $this->input->post('jobomschrijving');
        $alumnus->startdatumWerk = toYYYYMMDD($this->input->post('startdatumWerk'));
        $alumnus->secundairMail = $this->input->post('secundairEmailadres');




//        //gegevens voor login tabel ophalen
//        $naamArray = explode(" ", $this->input->post('naam'), 2);
//        $user->voornaam = $naamArray[0];
//        $user->achternaam = $naamArray[1];
//        $user->emailadres = $this->input->post('emailadres');
        //nodige models laden
//        $this->load->model('login_model');
        $this->load->model('alumnus_model');

        //bewerken van een alumnus
        $this->alumnus_model->updateProfiel($alumnus);

        //bewerken login tabel
//       $this->login_model->update($user);
        //Terug naar overzicht
        $data['title'] = 'Profiel - Alumni';
        $data['username'] = $this->session->userdata('username');


        redirect('alumnus/profiel');
    }

}

/* End of file home.php */
    /* Location: ./application/controllers/home.php */


    